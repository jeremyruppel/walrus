/**
 * Walrus.js 0.6.0
 * (c) 2012 Jeremy Ruppel
 * Walrus.js is freely distributable under the terms of the MIT license.
 * https://raw.github.com/jeremyruppel/walrus/master/LICENSE
 */
((function(){var a,b,c,d=Object.prototype.hasOwnProperty,e=function(a,b){function e(){this.constructor=a}for(var c in b)d.call(b,c)&&(a[c]=b[c]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a},f=Array.prototype.slice;c={VERSION:"0.6.0"};var g=function(){var a={trace:function(){},yy:{},symbols_:{error:2,document:3,text:4,EOF:5,statements:6,statement:7,OPEN:8,helper:9,mustache:10,block:11,SAFE:12,CLOSE:13,CONTENT:14,expression:15,PIPE:16,filters:17,ATTR:18,paths:19,DOT:20,primitive:21,OPEN_BLOCK:22,CLOSE_BLOCK:23,HELP:24,MEMBER:25,filter:26,OPEN_PAREN:27,arguments:28,CLOSE_PAREN:29,path:30,method:31,member:32,COMMA:33,argument:34,SINGLE_QUOTE_STRING_LITERAL:35,DOUBLE_QUOTE_STRING_LITERAL:36,BOOLEAN_FALSE:37,BOOLEAN_TRUE:38,NUMBER:39,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",8:"OPEN",12:"SAFE",13:"CLOSE",14:"CONTENT",16:"PIPE",18:"ATTR",20:"DOT",22:"OPEN_BLOCK",23:"CLOSE_BLOCK",24:"HELP",25:"MEMBER",27:"OPEN_PAREN",29:"CLOSE_PAREN",33:"COMMA",35:"SINGLE_QUOTE_STRING_LITERAL",36:"DOUBLE_QUOTE_STRING_LITERAL",37:"BOOLEAN_FALSE",38:"BOOLEAN_TRUE",39:"NUMBER"},productions_:[0,[3,2],[3,1],[4,1],[6,2],[6,1],[7,4],[7,3],[7,3],[7,1],[10,3],[10,1],[15,2],[15,1],[15,1],[15,1],[11,4],[9,2],[17,2],[17,1],[26,5],[26,2],[19,3],[19,1],[30,1],[30,1],[31,4],[31,3],[28,3],[28,1],[34,1],[21,1],[21,1],[21,1],[21,1],[21,1],[32,1]],performAction:function(b,c,d,e,f,g,h){var i=g.length-1;switch(f){case 1:return new e.DocumentNode(g[i-1]);case 2:return new e.DocumentNode([]);case 3:this.$=g[i];break;case 4:g[i-1].push(g[i]),this.$=g[i-1];break;case 5:this.$=[g[i]];break;case 6:this.$=new e.BlockNode(g[i-2],g[i-1],g[i]);break;case 7:this.$=new e.SafeNode(g[i-1]);break;case 8:this.$=g[i-1];break;case 9:this.$=new e.ContentNode(g[i]);break;case 10:this.$=new e.ExpressionNode(g[i-2],new e.FilterCollection(g[i]));break;case 11:this.$=new e.ExpressionNode(g[i],new e.FilterCollection([]));break;case 12:this.$=new e.PathNode(g[i],!1);break;case 13:this.$=new e.PathNode(g[i],!0);break;case 14:this.$=new e.ThisNode;break;case 15:this.$=g[i];break;case 16:this.$=new e.JoinedNodeCollection(g[i-2]);break;case 17:this.$=g[i];break;case 18:g[i-1].push(g[i]),this.$=g[i-1];break;case 19:this.$=[g[i]];break;case 20:this.$=new e.FilterNode(g[i-3],new e.NodeCollection(g[i-1]));break;case 21:this.$=new e.FilterNode(g[i],new e.NodeCollection([]));break;case 22:g[i-2].push(g[i]),this.$=g[i-2];break;case 23:this.$=[g[i]];break;case 24:this.$=g[i];break;case 25:this.$=g[i];break;case 26:this.$=new e.MethodNode(g[i-3],new e.NodeCollection(g[i-1]));break;case 27:this.$=new e.MethodNode(g[i-2],new e.NodeCollection([]));break;case 28:g[i-2].push(g[i]),this.$=g[i-2];break;case 29:this.$=[g[i]];break;case 30:this.$=g[i];break;case 31:this.$=new e.PrimitiveNode(g[i]);break;case 32:this.$=new e.PrimitiveNode(g[i]);break;case 33:this.$=new e.PrimitiveNode(!1);break;case 34:this.$=new e.PrimitiveNode(!0);break;case 35:this.$=new e.PrimitiveNode(parseFloat(g[i]));break;case 36:this.$=new e.MemberNode(g[i],!1)}},table:[{3:1,4:2,5:[1,3],6:4,7:5,8:[1,6],12:[1,7],14:[1,8]},{1:[3]},{5:[1,9]},{1:[2,2]},{5:[2,3],7:10,8:[1,6],12:[1,7],14:[1,8],23:[2,3]},{5:[2,5],8:[2,5],12:[2,5],14:[2,5],23:[2,5]},{9:11,10:12,15:14,18:[1,15],19:16,20:[1,17],21:18,24:[1,13],25:[1,27],30:19,31:25,32:26,35:[1,20],36:[1,21],37:[1,22],38:[1,23],39:[1,24]},{10:28,15:14,18:[1,15],19:16,20:[1,17],21:18,25:[1,27],30:19,31:25,32:26,35:[1,20],36:[1,21],37:[1,22],38:[1,23],39:[1,24]},{5:[2,9],8:[2,9],12:[2,9],14:[2,9],23:[2,9]},{1:[2,1]},{5:[2,4],8:[2,4],12:[2,4],14:[2,4],23:[2,4]},{10:29,15:14,18:[1,15],19:16,20:[1,17],21:18,25:[1,27],30:19,31:25,32:26,35:[1,20],36:[1,21],37:[1,22],38:[1,23],39:[1,24]},{13:[1,30]},{25:[1,31]},{13:[2,11],16:[1,32],22:[2,11]},{19:33,25:[1,27],30:19,31:25,32:26},{13:[2,13],16:[2,13],20:[1,34],22:[2,13],29:[2,13],33:[2,13]},{13:[2,14],16:[2,14],22:[2,14],29:[2,14],33:[2,14]},{13:[2,15],16:[2,15],22:[2,15],29:[2,15],33:[2,15]},{13:[2,23],16:[2,23],20:[2,23],22:[2,23],29:[2,23],33:[2,23]},{13:[2,31],16:[2,31],22:[2,31],29:[2,31],33:[2,31]},{13:[2,32],16:[2,32],22:[2,32],29:[2,32],33:[2,32]},{13:[2,33],16:[2,33],22:[2,33],29:[2,33],33:[2,33]},{13:[2,34],16:[2,34],22:[2,34],29:[2,34],33:[2,34]},{13:[2,35],16:[2,35],22:[2,35],29:[2,35],33:[2,35]},{13:[2,24],16:[2,24],20:[2,24],22:[2,24],29:[2,24],33:[2,24]},{13:[2,25],16:[2,25],20:[2,25],22:[2,25],29:[2,25],33:[2,25]},{13:[2,36],16:[2,36],20:[2,36],22:[2,36],27:[1,35],29:[2,36],33:[2,36]},{13:[1,36]},{11:37,22:[1,38]},{5:[2,8],8:[2,8],12:[2,8],14:[2,8],23:[2,8]},{18:[2,17],20:[2,17],25:[2,17],35:[2,17],36:[2,17],37:[2,17],38:[2,17],39:[2,17]},{17:39,24:[1,41],26:40},{13:[2,12],16:[2,12],20:[1,34],22:[2,12],29:[2,12],33:[2,12]},{25:[1,27],30:42,31:25,32:26},{15:46,18:[1,15],19:16,20:[1,17],21:18,25:[1,27],28:43,29:[1,44],30:19,31:25,32:26,34:45,35:[1,20],36:[1,21],37:[1,22],38:[1,23],39:[1,24]},{5:[2,7],8:[2,7],12:[2,7],14:[2,7],23:[2,7]},{5:[2,6],8:[2,6],12:[2,6],14:[2,6],23:[2,6]},{4:47,6:4,7:5,8:[1,6],12:[1,7],14:[1,8]},{13:[2,10],22:[2,10],24:[1,41],26:48},{13:[2,19],22:[2,19],24:[2,19]},{25:[1,49]},{13:[2,22],16:[2,22],20:[2,22],22:[2,22],29:[2,22],33:[2,22]},{29:[1,50],33:[1,51]},{13:[2,27],16:[2,27],20:[2,27],22:[2,27],29:[2,27],33:[2,27]},{29:[2,29],33:[2,29]},{29:[2,30],33:[2,30]},{23:[1,52]},{13:[2,18],22:[2,18],24:[2,18]},{13:[2,21],22:[2,21],24:[2,21],27:[1,53]},{13:[2,26],16:[2,26],20:[2,26],22:[2,26],29:[2,26],33:[2,26]},{15:46,18:[1,15],19:16,20:[1,17],21:18,25:[1,27],30:19,31:25,32:26,34:54,35:[1,20],36:[1,21],37:[1,22],38:[1,23],39:[1,24]},{13:[1,55]},{15:46,18:[1,15],19:16,20:[1,17],21:18,25:[1,27],28:56,30:19,31:25,32:26,34:45,35:[1,20],36:[1,21],37:[1,22],38:[1,23],39:[1,24]},{29:[2,28],33:[2,28]},{5:[2,16],8:[2,16],12:[2,16],14:[2,16],23:[2,16]},{29:[1,57],33:[1,51]},{13:[2,20],22:[2,20],24:[2,20]}],defaultActions:{3:[2,2],9:[2,1]},parseError:function(b,c){throw new Error(b)},parse:function(b){function o(a){d.length=d.length-2*a,e.length=e.length-a,f.length=f.length-a}function p(){var a;return a=c.lexer.lex()||1,typeof a!="number"&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0,l=2,m=1;this.lexer.setInput(b),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var n=this.lexer.yylloc;f.push(n),typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var q,r,s,t,u,v,w={},x,y,z,A;for(;;){s=d[d.length-1],this.defaultActions[s]?t=this.defaultActions[s]:(q==null&&(q=p()),t=g[s]&&g[s][q]);if(typeof t=="undefined"||!t.length||!t[0]){if(!k){A=[];for(x in g[s])this.terminals_[x]&&x>2&&A.push("'"+this.terminals_[x]+"'");var B="";this.lexer.showPosition?B="Parse error on line "+(i+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+A.join(", ")+", got '"+this.terminals_[q]+"'":B="Parse error on line "+(i+1)+": Unexpected "+(q==1?"end of input":"'"+(this.terminals_[q]||q)+"'"),this.parseError(B,{text:this.lexer.match,token:this.terminals_[q]||q,line:this.lexer.yylineno,loc:n,expected:A})}if(k==3){if(q==m)throw new Error(B||"Parsing halted.");j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,n=this.lexer.yylloc,q=p()}for(;;){if(l.toString()in g[s])break;if(s==0)throw new Error(B||"Parsing halted.");o(1),s=d[d.length-1]}r=q,q=l,s=d[d.length-1],t=g[s]&&g[s][l],k=3}if(t[0]instanceof Array&&t.length>1)throw new Error("Parse Error: multiple actions possible at state: "+s+", token: "+q);switch(t[0]){case 1:d.push(q),e.push(this.lexer.yytext),f.push(this.lexer.yylloc),d.push(t[1]),q=null,r?(q=r,r=null):(j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,n=this.lexer.yylloc,k>0&&k--);break;case 2:y=this.productions_[t[1]][1],w.$=e[e.length-y],w._$={first_line:f[f.length-(y||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(y||1)].first_column,last_column:f[f.length-1].last_column},v=this.performAction.call(w,h,j,i,this.yy,t[1],e,f);if(typeof v!="undefined")return v;y&&(d=d.slice(0,-1*y*2),e=e.slice(0,-1*y),f=f.slice(0,-1*y)),d.push(this.productions_[t[1]][0]),e.push(w.$),f.push(w._$),z=g[d[d.length-2]][d[d.length-1]],d.push(z);break;case 3:return!0}}return!0}},b=function(){var a={EOF:1,parseError:function(b,c){if(!this.yy.parseError)throw new Error(b);this.yy.parseError(b,c)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.match+=a,this.matched+=a;var b=a.match(/\n/);return b&&this.yylineno++,this._input=this._input.slice(1),a},unput:function(a){return this._input=a+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=(new Array(a.length+1)).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d,e,f;this._more||(this.yytext="",this.match="");var g=this._currentRules();for(var h=0;h<g.length;h++){c=this._input.match(this.rules[g[h]]);if(c&&(!b||c[0].length>b[0].length)){b=c,d=h;if(!this.options.flex)break}}if(b){f=b[0].match(/\n.*/g),f&&(this.yylineno+=f.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:f?f[f.length-1].length-1:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,g[d],this.conditionStack[this.conditionStack.length-1]);if(a)return a;return}if(this._input==="")return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var b=this.next();return typeof b!="undefined"?b:this.lex()},begin:function(b){this.conditionStack.push(b)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(b){this.begin(b)}};return a.options={},a.performAction=function(b,c,d,e){var f=e;switch(d){case 0:this.begin("mu");if(c.yytext)return 14;break;case 1:return 14;case 2:return this.begin("INITIAL"),22;case 3:return 23;case 4:return 12;case 5:return 8;case 6:return this.begin("INITIAL"),13;case 7:return 18;case 8:return 24;case 9:return 16;case 10:return 20;case 11:return 33;case 12:break;case 13:return c.yytext=c.yytext.substr(1,c.yyleng-2),35;case 14:return c.yytext=c.yytext.substr(1,c.yyleng-2),36;case 15:return 27;case 16:return 29;case 17:return 38;case 18:return 37;case 19:return 39;case 20:return 25;case 21:return 5}},a.rules=[/^[^\x00]*?(?=(\{\{))/,/^[^\x00]+/,/^do\s*\}\}\n*/,/^\{\{\s*end\b/,/^\{\{=/,/^\{\{/,/^\}\}\n*/,/^@/,/^:/,/^\|/,/^\./,/^,/,/^\s+/,/^'[^\']*?'/,/^"[^\"]*?"/,/^\(/,/^\)/,/^true\b/,/^false\b/,/^-?\d+(\.\d+)?/,/^[a-zA-Z0-9\_\$]+/,/^$/],a.conditions={mu:{rules:[2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21],inclusive:!1},INITIAL:{rules:[0,1,21],inclusive:!0}},a}();return a.lexer=b,a}();typeof require!="undefined"&&typeof exports!="undefined"&&(exports.parser=g,exports.parse=function(){return g.parse.apply(g,arguments)},exports.main=function(b){if(!b[1])throw new Error("Usage: "+b[0]+" FILE");if(typeof process!="undefined")var c=require("fs").readFileSync(require("path").join(process.cwd(),b[1]),"utf8");else var d=require("file").path(require("file").cwd()),c=d.join(b[1]).read({charset:"utf-8"});return exports.parser.parse(c)},typeof module!="undefined"&&require.main===module&&exports.main(typeof process!="undefined"?process.argv.slice(1):require("system").args)),b={trim:function(a){return a.replace(/^\s+|\s+$/g,"")},reduce:function(a,b,c){var d,e,f,g;e=b;for(f=0,g=a.length;f<g;f++)d=a[f],e=c(e,d);return e},toString:function(a){return Object.prototype.toString.call(a)},isArray:function(a){return this.toString(a)==="[object Array]"},extend:function(a,b){var c,d,e;e=[];for(c in b)d=b[c],e.push(a[c]=d);return e},escapees:/[&'"<>]/g,escapes:{"&":"&amp;","'":"&#x27;",'"':"&quot;","<":"&lt;",">":"&gt;"},escape:function(a){var b=this;return a!=null&&a.replace!=null?a.replace(this.escapees,function(a){return b.escapes[a]||a}):a}},c.Utils=b,a={},a.SafeNode=function(){function a(a){this.node=a}return a.prototype.compile=function(a,b,c){return this.node.compile(a,b,!0)},a}(),a.NodeCollection=function(){function a(a){this.nodes=a}return a.prototype.compile=function(a,b,c){var d,e,f,g,h;g=this.nodes,h=[];for(e=0,f=g.length;e<f;e++)d=g[e],h.push(d.compile(a,b,c));return h},a}(),a.JoinedNodeCollection=function(a){function b(a){this.nodes=a}return e(b,a),b.prototype.compile=function(a,c,d){return b.__super__.compile.call(this,a,c,d).join("")},b}(a.NodeCollection),a.DocumentNode=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.compile=function(a){return b.__super__.compile.call(this,a,a,!1)},b}(a.JoinedNodeCollection),a.ContentNode=function(){function a(a){this.content=a}return a.prototype.compile=function(a,b,c){return this.content},a}(),a.MemberNode=function(){function a(a){this.path=a}return a.prototype.compile=function(a,b,d,e){return e?a[this.path]:c.Utils.escape(a[this.path])},a}(),a.MethodNode=function(){function a(a,b){this.path=a,this.arguments=b}return a.prototype.compile=function(a,b,c,d){if(a[this.path]==null)throw new Error("Cannot find any method named '"+this.path+"' in "+a+".");return a[this.path].apply(a,this.arguments.compile(b,c,d))},a}(),a.ThisNode=function(){function a(){}return a.prototype.compile=function(a,b,c){return a},a}(),a.PathNode=function(){function a(a,b){this.paths=a,this.local=b}return a.prototype.compile=function(a,b,d){var e;return e=this.local?a:b,c.Utils.reduce(this.paths,e,function(c,e){return e.compile(c,a,b,d)})},a}(),a.PrimitiveNode=function(){function a(a){this.value=a}return a.prototype.compile=function(a,b,c){return this.value},a}(),a.ExpressionNode=function(){function a(a,b){this.paths=a,this.filters=b}return a.prototype.compile=function(a,b,c){return this.filters.apply(this.paths.compile(a,b,c),a,b,c)},a}(),a.BlockNode=function(){function a(a,b,d){this.name=a,this.expression=b,this.block=d;if(c.Helpers[this.name]==null)throw new Error("Cannot find any helper named '"+this.name+"'.")}return a.prototype.compile=function(a,b,d){return c.Helpers[this.name](this.expression,a,b,d,this.block)},a}(),a.FilterNode=function(){function a(a,b){this.name=a,this.arguments=b;if(c.Filters[this.name]==null)throw new Error("Cannot find any filter named '"+this.name+"'.")}return a.prototype.apply=function(a,b,d,e){var g;return(g=c.Filters)[this.name].apply(g,[a].concat(f.call(this.arguments.compile(b,d,e))))},a}(),a.FilterCollection=function(){function a(a){this.filters=a}return a.prototype.apply=function(a,b,d,e){return c.Utils.reduce(this.filters,a,function(a,c){return c.apply(a,b,d,e)})},a}(),c.AST=a,c.Helpers={},c.addHelper=function(a,b){if(this.Helpers[a]!=null)throw"Cannot override existing helper named '"+a+"'.";return this.Helpers[a]=b},c.addHelper("if",function(a,b,c,d,e){return a.compile(b,c,d)?e.compile(b,c,d):""}),c.addHelper("unless",function(a,b,c,d,e){return a.compile(b,c,d)?"":e.compile(b,c,d)}),c.addHelper("each",function(a,b,c,d,e){var f,g,h,i;return f=a.compile(b,c,d),i=function(){var a,i;i=[];for(g=0,a=f.length;g<a;g++)h=f[g],h.$index=g,h.$parent=b,h.$length=f.length,i.push(e.compile(h,c,d));return i}(),i.join("")}),c.addHelper("with",function(a,b,c,d,e){var f;return f=a.compile(b,c,d),f.$parent=b,e.compile(f,c,d)}),c.Filters={},c.addFilter=function(a,b){if(this.Filters[a]!=null)throw"Cannot override existing filter named '"+a+"'.";return this.Filters[a]=b},c.addFilter("equals",function(a,b){return a===b}),c.addFilter("if",function(a,b){return b?a:""}),c.addFilter("unless",function(a,b){return b?"":a}),c.addFilter("or",function(a,b){return a||b}),c.addFilter("log",function(){if(typeof console!="undefined"&&console!==null&&console.log!=null)return console.log.apply(console,["[Walrus]"].concat(f.call(arguments)))}),c.Parser={parser:g,parse:function(){return g.parse.apply(g,arguments)}},c.Parser.parser.yy=c.AST,function(a,b){return typeof exports=="object"?module.exports=b():typeof define=="function"&&define.amd?define("walrus",[],b()):a.Walrus=b}(this,function(){return c})})).call(this)